<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>티켓팅 타이머</title>
    <style>
      .gridSearch {
        display: flex;
        gap: 20px;
        align-items: center;
        justify-content: center;
      }
      .inputUrl {
        height: 3rem;
        width: 70%;
        font-size: 1rem;
        padding: 0px 15px 0px 15px;
        border-radius: 10px;
        border: none;
        box-shadow: 3px 3px 5px 3px rgb(206, 206, 206);
      }
      .gridSearch input:focus {
        box-shadow: 3px 3px 5px 3px rgb(215, 239, 255);
        outline: none;
      }
      .search {
        padding: 5px;
        border-radius: 10px;
        border: none;
        box-shadow: 3px 3px 5px 3px rgb(206, 206, 206);
        cursor: pointer;
      }
      .search:active {
        box-shadow: 3px 3px 5px 3px rgb(215, 239, 255);
        transform: scale(0.9);
      }
    </style>
  </head>
  <body>
    <section style="margin-top: 35px">
      <div class="gridSearch">
        <img src="image/clock.png" style="width: 3rem" />
        <input
          id="inputSearch"
          type="text"
          placeholder="사이트를 입력해 주세요."
          class="inputUrl"
        />
        <button id="btnSearch" class="search">
          <img src="image/search.png" style="width: 2.5rem" />
        </button>
      </div>
      <div>10312</div>
    </section>
    <section></section>
    <script>
      const time = () => {
        const url = document.getElementById("inputSearch").value;
        fetch(url)
          .then((req) => {
            timeFormat(new Date(req.headers.get("Date")));
          })
          .catch((error) => {
            console.log(error);
          });
      };
      const timeFormat = (serverTime) => {
        if (serverTime) {
          const serverTimeInMillis = new Date(serverTime).getTime();
          const localTimeInMillis = new Date().getTime();

          // 서버 시간 - 로컬 시간 = 서버 시간 근사값 추정, 밀리초 까지의 시차를 계산
          const timeDifferenceInMillis = serverTimeInMillis - localTimeInMillis;
          const approximatedServerTimeInMillis =
            localTimeInMillis + timeDifferenceInMillis;

          const serverDate = new Date(approximatedServerTimeInMillis);
          const year = serverDate.getFullYear();
          const month = serverDate.getMonth() + 1;
          const day = serverDate.getDate();
          const hour = serverDate.getHours();
          const minute = serverDate.getMinutes();
          const second = serverDate.getSeconds();
          const millisecond = serverDate.getMilliseconds();

          console.log(
            `${year}-${month}-${day} ${hour}:${minute}:${second}.${millisecond}`
          );
        } else {
          console.log("서버 시간을 가져올 수 없습니다.");
        }
      };

      // 검색 버튼
      document
        .getElementById("btnSearch")
        .addEventListener("click", function () {
          time();
        });

      // 검색 엔터
      document
        .getElementById("inputSearch")
        .addEventListener("keyup", function (event) {
          if (event.keyCode === 13) {
            time();
          }
        });
    </script>
  </body>
</html>
